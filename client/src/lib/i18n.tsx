import { createContext, useContext, useState, useEffect, useCallback, ReactNode } from "react";
import type { ContentBlock } from "@shared/schema";

export type Language = "he" | "en";

interface LanguageContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;
  isRTL: boolean;
}

// CMS content cache
let cmsContentCache: ContentBlock[] | null = null;
let cmsContentPromise: Promise<ContentBlock[]> | null = null;

async function fetchCmsContent(): Promise<ContentBlock[]> {
  if (cmsContentCache) return cmsContentCache;
  if (cmsContentPromise) return cmsContentPromise;

  cmsContentPromise = fetch("/api/content-blocks")
    .then((res) => {
      if (!res.ok) return [];
      return res.json();
    })
    .then((data) => {
      cmsContentCache = data;
      return data;
    })
    .catch(() => [])
    .finally(() => {
      cmsContentPromise = null;
    });

  return cmsContentPromise;
}

// Map i18n keys to CMS section.blockKey format
function i18nKeyToCms(key: string): { section: string; blockKey: string } | null {
  // Map common patterns
  const mappings: Record<string, { section: string; blockKey: string }> = {
    // Hero section
    "hero.title1": { section: "hero", blockKey: "title1" },
    "hero.title2": { section: "hero", blockKey: "title2" },
    "hero.title3": { section: "hero", blockKey: "title3" },
    "hero.subtitle1": { section: "hero", blockKey: "subtitle1" },
    "hero.subtitle2": { section: "hero", blockKey: "subtitle2" },
    "hero.subtitle3": { section: "hero", blockKey: "subtitle3" },
    "hero.tagline": { section: "hero", blockKey: "tagline" },
    "hero.cta": { section: "hero", blockKey: "cta" },
    "hero.calculator": { section: "hero", blockKey: "calculator" },
    "hero.stat.tax": { section: "hero", blockKey: "stat_tax_label" },
    "hero.stat.yield": { section: "hero", blockKey: "stat_yield_label" },
    "hero.stat.ownership": { section: "hero", blockKey: "stat_ownership_label" },
    "hero.stat.support": { section: "hero", blockKey: "stat_support_label" },
    "hero.trust.licensed": { section: "hero", blockKey: "trust_licensed" },
    "hero.trust.verified": { section: "hero", blockKey: "trust_verified" },
    // About section
    "about.badge": { section: "about", blockKey: "badge" },
    "about.heading": { section: "about", blockKey: "title" },
    "about.p1": { section: "about", blockKey: "description" },
    "about.p2": { section: "about", blockKey: "p2" },
    "about.p2b": { section: "about", blockKey: "p2b" },
    "about.license": { section: "about", blockKey: "license" },
    "about.licenseNum": { section: "about", blockKey: "licenseNum" },
    "about.licenseDesc": { section: "about", blockKey: "licenseDesc" },
    "about.feat1.title": { section: "about", blockKey: "card1_title" },
    "about.feat1.desc": { section: "about", blockKey: "card1_desc" },
    "about.feat2.title": { section: "about", blockKey: "card2_title" },
    "about.feat2.desc": { section: "about", blockKey: "card2_desc" },
    "about.feat3.title": { section: "about", blockKey: "card3_title" },
    "about.feat3.desc": { section: "about", blockKey: "card3_desc" },
    "about.feat4.title": { section: "about", blockKey: "card4_title" },
    "about.feat4.desc": { section: "about", blockKey: "card4_desc" },
    // WhyDDL section
    "whyddl.badge": { section: "whyDdl", blockKey: "badge" },
    "whyddl.heading": { section: "whyDdl", blockKey: "title" },
    "whyddl.subheading": { section: "whyDdl", blockKey: "subtitle" },
    "whyddl.quote1": { section: "whyDdl", blockKey: "quote" },
    "whyddl.reason1.title": { section: "whyDdl", blockKey: "reason1_title" },
    "whyddl.reason1.desc": { section: "whyDdl", blockKey: "reason1_desc" },
    "whyddl.reason2.title": { section: "whyDdl", blockKey: "reason2_title" },
    "whyddl.reason2.desc": { section: "whyDdl", blockKey: "reason2_desc" },
    "whyddl.reason3.title": { section: "whyDdl", blockKey: "reason3_title" },
    "whyddl.reason3.desc": { section: "whyDdl", blockKey: "reason3_desc" },
    "whyddl.reason4.title": { section: "whyDdl", blockKey: "reason4_title" },
    "whyddl.reason4.desc": { section: "whyDdl", blockKey: "reason4_desc" },
    "whyddl.reason5.title": { section: "whyDdl", blockKey: "reason5_title" },
    "whyddl.reason5.desc": { section: "whyDdl", blockKey: "reason5_desc" },
    "whyddl.reason6.title": { section: "whyDdl", blockKey: "reason6_title" },
    "whyddl.reason6.desc": { section: "whyDdl", blockKey: "reason6_desc" },
    // WhyDubai section
    "whyDubai.badge": { section: "whyDubai", blockKey: "badge" },
    "whyDubai.heading": { section: "whyDubai", blockKey: "title" },
    "whyDubai.subheading": { section: "whyDubai", blockKey: "subtitle" },
    // Process section
    "process.badge": { section: "process", blockKey: "badge" },
    "process.heading": { section: "process", blockKey: "title" },
    "process.subheading": { section: "process", blockKey: "subtitle" },
    // Footer section
    "footer.tagline": { section: "footer", blockKey: "tagline" },
    "footer.license": { section: "footer", blockKey: "license" },
    "footer.copyright": { section: "footer", blockKey: "copyright" },
    "footer.quickLinks": { section: "footer", blockKey: "quickLinks" },
    "footer.contactUs": { section: "footer", blockKey: "contactUs" },
    "footer.followUs": { section: "footer", blockKey: "followUs" },
    "footer.location": { section: "footer", blockKey: "location" },
    "footer.terms": { section: "footer", blockKey: "terms" },
    "footer.privacy": { section: "footer", blockKey: "privacy" },
    "footer.disclaimer": { section: "footer", blockKey: "disclaimer" },
    // Navigation
    "nav.home": { section: "nav", blockKey: "home" },
    "nav.projects": { section: "nav", blockKey: "projects" },
    "nav.process": { section: "nav", blockKey: "process" },
    "nav.whyDubai": { section: "nav", blockKey: "whyDubai" },
    "nav.contact": { section: "nav", blockKey: "contact" },
    "nav.freeConsultation": { section: "nav", blockKey: "freeConsultation" },
  };

  return mappings[key] || null;
}

// Export function to clear cache (for admin updates)
export function clearCmsContentCache() {
  cmsContentCache = null;
}

const translations: Record<Language, Record<string, string>> = {
  he: {
    "nav.home": "דף הבית",
    "nav.projects": "פרויקטים",
    "nav.process": "תהליך ההשקעה",
    "nav.whyDubai": "למה דובאי",
    "nav.contact": "צור קשר",
    "nav.freeConsultation": "דברו איתנו",
    "hero.title1": "השקעות נדל״ן בדובאי",
    "hero.subtitle1": "פשוט. שקוף. מסודר.",
    "hero.title2": "גישה ישירה לפרויקטים",
    "hero.subtitle2": "סוכן מקומי מורשה בדובאי",
    "hero.title3": "ליווי מקצה לקצה",
    "hero.subtitle3": "מהשלב הראשון ועד קבלת המפתח",
    "hero.tagline": "ליווי משקיעים להשקעות נדל״ן בדובאי בצורה פשוטה, שקופה ומסודרת",
    "hero.cta": "התחל השקעה",
    "hero.calculator": "מחשבון ROI",
    "hero.stat.tax": "מס הכנסה",
    "hero.stat.yield": "תשואה ממוצעת",
    "hero.stat.ownership": "בעלות מלאה",
    "hero.stat.support": "תמיכה וליווי",
    "hero.trust.licensed": "מורשה RERA",
    "hero.trust.verified": "מאומת",
    "hero.socialProof": "200+ עסקאות מוצלחות",
    "contact.responseTime": "נחזור אליכם תוך 24 שעות",
    "about.title": "מי אנחנו",
    "about.subtitle": "DDL - הדרך שלך להשקעה חכמה בדובאי",
    "about.description": "אנחנו סוכנות נדל״ן ישראלית המתמחה בליווי משקיעים בשוק הנדל״ן של דובאי. עם ניסיון רב ומומחיות מקומית, אנחנו מספקים פתרונות מותאמים אישית לכל משקיע.",
    "about.experience": "שנות ניסיון",
    "about.clients": "לקוחות מרוצים",
    "about.projects": "פרויקטים",
    "about.value": "שווי עסקאות",
    "whyDubai.title": "למה דובאי?",
    "whyDubai.subtitle": "הזדמנות השקעה ייחודית",
    "whyDubai.tax.title": "0% מס הכנסה",
    "whyDubai.tax.desc": "ללא מס על רווחי הון או הכנסות משכירות",
    "whyDubai.yield.title": "תשואות גבוהות",
    "whyDubai.yield.desc": "תשואה ממוצעת של 8-12% על השכרת נכסים",
    "whyDubai.growth.title": "צמיחה מתמדת",
    "whyDubai.growth.desc": "שוק נדל״ן יציב עם עלייה קבועה בערכי הנכסים",
    "whyDubai.safety.title": "ביטחון משפטי",
    "whyDubai.safety.desc": "בעלות מלאה לזרים באזורי Freehold",
    "whyDubai.quality.title": "איכות חיים",
    "whyDubai.quality.desc": "תשתיות מתקדמות ורמת חיים גבוהה",
    "whyDubai.vision.title": "חזון 2040",
    "whyDubai.vision.desc": "תוכנית פיתוח אורבנית שאפתנית",
    "process.title": "תהליך ההשקעה",
    "process.subtitle": "5 צעדים פשוטים להשקעה מוצלחת",
    "process.step1.title": "ייעוץ ראשוני",
    "process.step1.desc": "שיחת היכרות להבנת הצרכים והיעדים שלך",
    "process.step2.title": "בחירת נכס",
    "process.step2.desc": "התאמת פרויקטים לפי תקציב ומטרות השקעה",
    "process.step3.title": "הזמנת יחידה",
    "process.step3.desc": "חתימה על הסכם וביצוע תשלום ראשון",
    "process.step4.title": "מעקב בנייה",
    "process.step4.desc": "עדכונים שוטפים על התקדמות הפרויקט",
    "process.step5.title": "קבלת מפתח",
    "process.step5.desc": "מסירת הנכס וליווי בהשכרה או מכירה",
    "calculator.title": "מחשבון תשואה",
    "calculator.subtitle": "חשב את פוטנציאל ההשקעה שלך",
    "calculator.propertyPrice": "מחיר הנכס",
    "calculator.downPayment": "מקדמה",
    "calculator.rentalYield": "תשואת שכירות שנתית",
    "calculator.appreciation": "עליית ערך שנתית",
    "calculator.years": "תקופת השקעה (שנים)",
    "calculator.calculate": "חשב תשואה",
    "calculator.results.title": "תוצאות",
    "calculator.results.totalReturn": "תשואה כוללת",
    "calculator.results.roi": "ROI",
    "calculator.results.monthlyRent": "שכירות חודשית",
    "contact.title": "צור קשר",
    "contact.subtitle": "מעוניינים לשמוע עוד? השאירו פרטים ונחזור אליכם",
    "contact.name": "שם מלא",
    "contact.phone": "טלפון",
    "contact.email": "אימייל",
    "contact.message": "הודעה",
    "contact.send": "שלח הודעה",
    "contact.sending": "שולח...",
    "contact.success": "ההודעה נשלחה בהצלחה!",
    "contact.error": "שגיאה בשליחה, נסה שוב",
    "footer.rights": "כל הזכויות שמורות",
    "footer.privacy": "מדיניות פרטיות",
    "footer.terms": "תנאי שימוש",
    "footer.disclaimer": "כתב ויתור",
    "projects.title": "הפרויקטים שלנו",
    "projects.subtitle": "מגוון הזדמנויות השקעה מובילות",
    "projects.empty": "פרויקטים חדשים יתווספו בקרוב",
    "projects.viewDetails": "לפרטים נוספים",
    "projects.from": "החל מ-",
    "whyddl.title": "למה DDL?",
    "whyddl.subtitle": "היתרונות שלנו",
    "whyddl.expertise.title": "מומחיות מקומית",
    "whyddl.expertise.desc": "סוכנים מורשים עם הכרות מעמיקה של השוק",
    "whyddl.transparent.title": "שקיפות מלאה",
    "whyddl.transparent.desc": "מידע ברור על כל עסקה ללא עלויות נסתרות",
    "whyddl.support.title": "ליווי אישי",
    "whyddl.support.desc": "תמיכה צמודה לאורך כל התהליך",
    "whyddl.access.title": "גישה בלעדית",
    "whyddl.access.desc": "הזדמנויות מהיזמים המובילים בדובאי",
    "about.badge": "אודות DDL",
    "about.heading": "מי אנחנו",
    "about.p1": "DDL היא חברת ליווי להשקעות נדל״ן בדובאי. אנחנו מתמחים בליווי משקיעים פרטיים בהשקעות נדל״ן בדובאי – מהשלב הראשון ועד לאחר סגירת העסקה.",
    "about.p2": "בלי רעש ובלי הבטחות.",
    "about.p2b": "רק תהליך ברור ועבודה מהשטח.",
    "about.license": "סוכן מקומי מורשה",
    "about.licenseNum": "רישיון RERA מספר 55545",
    "about.licenseDesc": "אנחנו חיים ופועלים מדובאי. גישה אמיתית לפרויקטים, עבודה ישירה מול קבלנים, והבנה עמוקה של מה שקורה בשוק בזמן אמת.",
    "about.feat1.title": "סוכן מקומי בדובאי",
    "about.feat1.desc": "החברה פועלת מדובאי, הצוות נמצא בדובאי, והעבודה מתבצעת מתוך השוק עצמו",
    "about.feat2.title": "ליווי אישי",
    "about.feat2.desc": "כל משקיע מקבל יחס אישי ומותאם לצרכים ולמטרות שלו",
    "about.feat3.title": "שקיפות מלאה",
    "about.feat3.desc": "מציגים את התמונה המלאה - לא רק את ההזדמנות, גם את הסיכון",
    "about.feat4.title": "זמינות 24/7",
    "about.feat4.desc": "תמיכה רציפה בכל שלב של התהליך, מתחילתו ועד סופו",
    "contact.badge": "ייעוץ ללא עלות",
    "contact.heading": "קבלו הצעת השקעה מותאמת אישית",
    "contact.subheading": "השאירו פרטים ונחזור אליכם תוך 24 שעות לשיחת היכרות קצרה",
    "contact.name.label": "שם מלא",
    "contact.name.placeholder": "הזן את שמך",
    "contact.phone.label": "טלפון",
    "contact.phone.placeholder": "050-000-0000",
    "contact.email.label": "אימייל (אופציונלי)",
    "contact.email.placeholder": "your@email.com",
    "contact.submit": "קבל ייעוץ חינם",
    "contact.submitting": "שולח...",
    "contact.success.title": "הטופס נשלח בהצלחה!",
    "contact.success.desc": "נחזור אליך תוך 24 שעות",
    "contact.success.heading": "תודה על פנייתך!",
    "contact.success.text": "קיבלנו את הפרטים שלך ונחזור אליך תוך 24 שעות.",
    "contact.success.another": "שליחת פנייה נוספת",
    "contact.error.title": "שגיאה בשליחת הטופס",
    "contact.error.desc": "אנא נסה שוב מאוחר יותר",
    "footer.tagline": "ליווי משקיעים להשקעות נדל״ן בדובאי בצורה פשוטה, שקופה ומסודרת.",
    "footer.license": "סוכן מקומי מורשה - רישיון 55545",
    "footer.quickLinks": "ניווט מהיר",
    "footer.contactUs": "יצירת קשר",
    "footer.location": "דובאי, איחוד האמירויות הערביות",
    "footer.followUs": "עקבו אחרינו",
    "footer.newsletter": "קבלו עדכונים:",
    "footer.emailPlaceholder": "האימייל שלך",
    "footer.subscribe": "הרשמה",
    "footer.subscribeSuccess": "נרשמת בהצלחה!",
    "footer.subscribeSuccessDesc": "תקבל עדכונים ישירות למייל",
    "footer.emailError": "אנא הזן כתובת אימייל תקינה",
    "footer.error": "אירעה שגיאה, נסה שוב מאוחר יותר",
    "footer.copyright": "כל הזכויות שמורות.",
    "whyDubai.badge": "יתרונות השקעה",
    "whyDubai.heading": "למה להשקיע בדובאי?",
    "whyDubai.subheading": "דובאי הפכה למוקד השקעות עולמי. מעיר אזורית – למרכז עולמי לעסקים, הון ואוכלוסייה",
    "whyDubai.bottom.title": "השורה התחתונה",
    "whyDubai.bottom.text": "זו לא \"בועה רגעית\", אלא",
    "whyDubai.bottom.highlight": "אסטרטגיה לאומית ארוכת טווח",
    "whyDubai.bottom.text2": ". ממשלת איחוד האמירויות משקיעה מיליארדים בפיתוח תשתיות, תיירות וטכנולוגיה כדי להפוך את דובאי למרכז עולמי.",
    "process.badge": "תהליך ההשקעה",
    "process.heading": "10 שלבים להשקעה מוצלחת",
    "process.subheading": "תהליך מובנה ושקוף שמבטיח לכם שקט נפשי וביטחון בכל שלב בדרך להשקעה בדובאי",
    "process.bottom": "תהליך מסודר הוא המפתח להשקעה בטוחה ומוצלחת",
    "stats.title": "המספרים שלנו מדברים",
    "stats.subtitle": "ביצועים מוכחים בשוק הנדל\"ן של דובאי",
    "stats.projects": "פרויקטים פעילים",
    "stats.investors": "משקיעים מרוצים",
    "stats.yield": "תשואה ממוצעת",
    "stats.experience": "שנות ניסיון",
    "calc.badge": "מחשבון השקעה חכם",
    "calc.title": "כמה תרוויחו מהשקעה בדובאי?",
    "calc.subtitle": "הזינו את התקציב שלכם וקבלו הערכה מותאמת אישית לתשואה הצפויה",
    "calc.budget": "תקציב השקעה",
    "calc.budgetNote": "(הזנה ב-AED, תצוגה במטבע הנבחר)",
    "calc.expectedRoi": "תשואה שנתית צפויה (%)",
    "calc.expectedRoiNote": "הזינו את אחוז התשואה השנתי הצפוי לדעתכם",
    "calc.perYear": "לשנה",
    "calc.type": "סוג השקעה",
    "calc.type.placeholder": "בחר סוג השקעה",
    "calc.type.offplan": "על הנייר (Off-Plan)",
    "calc.type.offplan.desc": "רכישה מקבלן לפני סיום הבנייה - פוטנציאל השבחה גבוה",
    "calc.type.ready": "נכס מוכן (Ready)",
    "calc.type.ready.desc": "נכס מוכן להשכרה - תזרים מזומנים שוטף",
    "calc.type.mixed": "שילוב (Mixed)",
    "calc.type.mixed.desc": "שילוב בין השבחה לתשואה שוטפת",
    "calc.timeline": "טווח השקעה (שנים)",
    "calc.timeline.one": "שנה אחת",
    "calc.timeline.years": "שנים",
    "calc.forecast": "התחזית שלך",
    "calc.investment": "סכום השקעה",
    "calc.period": "תקופה",
    "calc.expected": "ערך צפוי בסוף התקופה",
    "calc.monthly": "הכנסה חודשית צפויה משכירות",
    "calc.cta": "קבל המלצה מותאמת אישית",
    "calc.disclaimer": "* התחזית מבוססת על ממוצעי השוק ואינה מהווה התחייבות לתשואה",
    "calc.historical.title": "נקודת ייחוס היסטורית – השבחת נכסים בדובאי",
    "calc.historical.intro": "לצורך השוואה בלבד, נתוני שוק מצביעים על כך שבעשור האחרון מחירי נכסי מגורים בדובאי עלו בכ־80%+ במצטבר, עם ממוצע רב־שנתי שנע סביב 7%–9% לשנה, ותנודתיות בין שנים חזקות וחלשות.",
    "calc.historical.point1": "עלייה מצטברת בעשור האחרון (2012–2024): כ-80%+",
    "calc.historical.point2": "ממוצע רב־שנתי מוערך: כ-7%–9% לשנה",
    "calc.historical.point3": "בשנים חזקות במיוחד: ייתכנו גם עליות דו-ספרתיות",
    "calc.historical.point4": "בשנים חלשות: ייתכנו קיפאון או ירידות זמניות",
    "calc.historical.disclaimer": "הנתונים היסטוריים בלבד, מבוססים על מגמות שוק כלליות, ואינם מהווים הבטחה, תחזית או ייעוץ השקעה. התוצאה במחשבון מבוססת אך ורק על הנתונים שהוזנו על ידך.",
    "projects.badge": "פרויקטים נבחרים",
    "projects.heading": "הפרויקטים החמים בדובאי",
    "projects.subheading": "מבחר פרויקטים מובילים מהקבלנים הטובים ביותר באזורים המבוקשים",
    "projects.filter": "סינון לפי אזור",
    "projects.all": "כל האזורים",
    "projects.compare": "השווה",
    "projects.coming": "פרויקטים חדשים בקרוב...",
    "projects.featured": "מומלץ",
    "projects.startingFrom": "החל מ-",
    "projects.details": "פרטים נוספים",
    "projects.compare.title": "השוואת פרויקטים",
    "projects.compare.param": "פרמטר",
    "projects.compare.price": "מחיר התחלתי",
    "projects.compare.roi": "תשואה צפויה",
    "projects.compare.location": "מיקום",
    "projects.compare.developer": "קבלן",
    "projects.compare.type": "סוג נכס",
    "projects.compare.delivery": "מועד מסירה",
    "projects.compare.ready": "מוכן",
    "map.badge": "מפה אינטראקטיבית",
    "map.title": "אזורי ההשקעה החמים בדובאי",
    "map.subtitle": "לחצו על אזור במפה לקבלת מידע מפורט על תשואות, ביקוש ופרויקטים זמינים",
    "map.unavailable": "המפה לא זמינה",
    "map.unavailable.desc": "נדרש מפתח Mapbox להצגת המפה האינטראקטיבית",
    "map.loading": "טוען מפה...",
    "map.reset": "איפוס",
    "map.projects": "פרויקטים",
    "map.avgRoi": "ROI ממוצע",
    "map.rental": "תשואת שכירות",
    "map.appreciation": "עליית ערך",
    "map.demand": "רמת ביקוש",
    "map.demand.veryHigh": "ביקוש גבוה מאוד",
    "map.demand.high": "ביקוש גבוה",
    "map.demand.medium": "ביקוש בינוני",
    "map.demand.premium": "שוק פרימיום",
    "map.zoneProjects": "פרויקטים באזור",
    "map.noProjects": "אין פרויקטים באזור זה כרגע",
    "map.startingFrom": "החל מ-",
    "map.selectZone": "בחר אזור",
    "map.selectZone.desc": "לחץ על אחד מהאזורים במפה לקבלת מידע מפורט",
    "map.tapToExplore": "לחץ לגלישה במפה",
    "map.done": "סיום",
    "whyddl.badge": "למה DDL",
    "whyddl.heading": "מה מייחד אותנו?",
    "whyddl.subheading": "פשטות. שקיפות. ליווי אישי.",
    "whyddl.quote1": "המטרה שלנו אינה למכור נכס,",
    "whyddl.quote2": "אלא לבנות עסקה נכונה לטווח הנכון",
    "whyddl.reason1.title": "סוכן מקומי בדובאי",
    "whyddl.reason1.desc": "אנחנו חיים ופועלים מדובאי - לא שליחים מרחוק. גישה אמיתית לפרויקטים ועבודה ישירה מול קבלנים.",
    "whyddl.reason2.title": "תהליך שקוף ומסודר",
    "whyddl.reason2.desc": "5 שלבים ברורים ללא הפתעות. אנחנו מציגים את התמונה המלאה - יתרונות לצד סיכונים.",
    "whyddl.reason3.title": "ללא עמלות נסתרות",
    "whyddl.reason3.desc": "עמלות גלויות מראש. מה שסוכם - זה מה שקורה. בלי תוספות ובלי אותיות קטנות.",
    "whyddl.reason4.title": "ליווי אישי צמוד",
    "whyddl.reason4.desc": "כל משקיע מקבל מנהל לקוח אישי שילווה אותו מהשלב הראשון ועד לאחר סגירת העסקה.",
    "whyddl.reason5.title": "זמינות 24/7",
    "whyddl.reason5.desc": "תמיד זמינים לשאלות ולעדכונים. הפרשי השעות לא מעכבים אותנו.",
    "whyddl.reason6.title": "ביטחון בעסקה",
    "whyddl.reason6.desc": "עובדים רק עם קבלנים מאושרים וליווי משפטי מלא בכל שלב.",
    "cases.badge": "מקרי מבחן",
    "cases.title": "משקיעים אמיתיים, תוצאות אמיתיות",
    "cases.subtitle": "דוגמאות להשקעות מוצלחות שליווינו - מהשקעה ראשונית ועד למימוש",
    "cases.initial": "השקעה ראשונית",
    "cases.current": "ערך נוכחי",
    "cases.invested": "השקעה ב-",
    "cases.yielding": "נכס מניב",
    "cases.sold": "מכירה ב-",
    "cases.disclaimer": "* הנתונים מבוססים על עסקאות אמיתיות. שמות המשקיעים מוסתרים לצורכי פרטיות.",
    "developers.title": "עובדים עם הקבלנים המובילים",
    "zones.badge": "אזורי השקעה",
    "zones.title": "אזורי ההשקעה החמים בדובאי",
    "zones.subtitle": "בחרו אזור לקבלת מידע מפורט על תשואות, ביקוש ופרויקטים זמינים",
    "zones.roi": "ROI",
    "zones.rental": "שכירות",
    "zones.appreciation": "עליית ערך",
    "zones.avgRoi": "ROI ממוצע",
    "zones.rentalYield": "תשואת שכירות",
    "zones.demandLevel": "רמת ביקוש",
    "zones.projectsCount": "פרויקטים",
    "zones.viewDetails": "פרטים נוספים",
    "zones.zoneProjects": "פרויקטים באזור",
    "zones.noProjects": "אין פרויקטים באזור זה כרגע",
    "zones.getConsultation": "קבל ייעוץ לאזור זה",
  },
  en: {
    "nav.home": "Home",
    "nav.projects": "Projects",
    "nav.process": "Investment Process",
    "nav.whyDubai": "Why Dubai",
    "nav.contact": "Contact",
    "nav.freeConsultation": "Talk to Us",
    "hero.title1": "Real Estate Investment in Dubai",
    "hero.subtitle1": "Simple. Transparent. Organized.",
    "hero.title2": "Direct Access to Projects",
    "hero.subtitle2": "Licensed Local Agent in Dubai",
    "hero.title3": "End-to-End Support",
    "hero.subtitle3": "From First Step to Key Handover",
    "hero.tagline": "Guiding investors through Dubai real estate investments in a simple, transparent, and organized manner",
    "hero.cta": "Start Investing",
    "hero.calculator": "ROI Calculator",
    "hero.stat.tax": "Income Tax",
    "hero.stat.yield": "Average Yield",
    "hero.stat.ownership": "Full Ownership",
    "hero.stat.support": "Support 24/7",
    "hero.trust.licensed": "RERA Licensed",
    "hero.trust.verified": "Verified",
    "hero.socialProof": "200+ Successful Deals",
    "contact.responseTime": "We'll get back to you within 24 hours",
    "about.title": "About Us",
    "about.subtitle": "DDL - Your Path to Smart Investment in Dubai",
    "about.description": "We are an Israeli real estate agency specializing in guiding investors in Dubai's real estate market. With extensive experience and local expertise, we provide personalized solutions for every investor.",
    "about.experience": "Years Experience",
    "about.clients": "Happy Clients",
    "about.projects": "Projects",
    "about.value": "Transaction Value",
    "whyDubai.title": "Why Dubai?",
    "whyDubai.subtitle": "A Unique Investment Opportunity",
    "whyDubai.tax.title": "0% Income Tax",
    "whyDubai.tax.desc": "No tax on capital gains or rental income",
    "whyDubai.yield.title": "High Yields",
    "whyDubai.yield.desc": "Average yield of 8-12% on property rentals",
    "whyDubai.growth.title": "Continuous Growth",
    "whyDubai.growth.desc": "Stable real estate market with consistent property value appreciation",
    "whyDubai.safety.title": "Legal Security",
    "whyDubai.safety.desc": "Full ownership for foreigners in Freehold areas",
    "whyDubai.quality.title": "Quality of Life",
    "whyDubai.quality.desc": "Advanced infrastructure and high standard of living",
    "whyDubai.vision.title": "Vision 2040",
    "whyDubai.vision.desc": "Ambitious urban development plan",
    "process.title": "Investment Process",
    "process.subtitle": "5 Simple Steps to Successful Investment",
    "process.step1.title": "Initial Consultation",
    "process.step1.desc": "Introductory call to understand your needs and goals",
    "process.step2.title": "Property Selection",
    "process.step2.desc": "Matching projects based on budget and investment goals",
    "process.step3.title": "Unit Reservation",
    "process.step3.desc": "Signing agreement and making initial payment",
    "process.step4.title": "Construction Tracking",
    "process.step4.desc": "Regular updates on project progress",
    "process.step5.title": "Key Handover",
    "process.step5.desc": "Property delivery and support for rental or sale",
    "calculator.title": "ROI Calculator",
    "calculator.subtitle": "Calculate Your Investment Potential",
    "calculator.propertyPrice": "Property Price",
    "calculator.downPayment": "Down Payment",
    "calculator.rentalYield": "Annual Rental Yield",
    "calculator.appreciation": "Annual Appreciation",
    "calculator.years": "Investment Period (Years)",
    "calculator.calculate": "Calculate ROI",
    "calculator.results.title": "Results",
    "calculator.results.totalReturn": "Total Return",
    "calculator.results.roi": "ROI",
    "calculator.results.monthlyRent": "Monthly Rent",
    "contact.title": "Contact Us",
    "contact.subtitle": "Interested to learn more? Leave your details and we'll get back to you",
    "contact.name": "Full Name",
    "contact.phone": "Phone",
    "contact.email": "Email",
    "contact.message": "Message",
    "contact.send": "Send Message",
    "contact.sending": "Sending...",
    "contact.success": "Message sent successfully!",
    "contact.error": "Error sending, please try again",
    "footer.rights": "All Rights Reserved",
    "footer.privacy": "Privacy Policy",
    "footer.terms": "Terms of Use",
    "footer.disclaimer": "Investment Disclaimer",
    "projects.title": "Our Projects",
    "projects.subtitle": "Leading Investment Opportunities",
    "projects.empty": "New projects coming soon",
    "projects.viewDetails": "View Details",
    "projects.from": "From ",
    "whyddl.title": "Why DDL?",
    "whyddl.subtitle": "Our Advantages",
    "whyddl.expertise.title": "Local Expertise",
    "whyddl.expertise.desc": "Licensed agents with deep market knowledge",
    "whyddl.transparent.title": "Full Transparency",
    "whyddl.transparent.desc": "Clear information on every transaction with no hidden costs",
    "whyddl.support.title": "Personal Support",
    "whyddl.support.desc": "Close guidance throughout the entire process",
    "whyddl.access.title": "Exclusive Access",
    "whyddl.access.desc": "Opportunities from Dubai's leading developers",
    "about.badge": "About DDL",
    "about.heading": "Who We Are",
    "about.p1": "DDL is a real estate investment guidance company in Dubai. We specialize in guiding private investors in Dubai real estate investments – from the first step to after closing the deal.",
    "about.p2": "No noise and no promises.",
    "about.p2b": "Just a clear process and work from the field.",
    "about.license": "Licensed Local Agent",
    "about.licenseNum": "RERA License Number 55545",
    "about.licenseDesc": "We live and operate from Dubai. Real access to projects, direct work with contractors, and deep understanding of what's happening in the market in real time.",
    "about.feat1.title": "Local Agent in Dubai",
    "about.feat1.desc": "The company operates from Dubai, the team is in Dubai, and the work is done from within the market itself",
    "about.feat2.title": "Personal Guidance",
    "about.feat2.desc": "Every investor receives personalized attention tailored to their needs and goals",
    "about.feat3.title": "Full Transparency",
    "about.feat3.desc": "We present the full picture - not just the opportunity, but also the risk",
    "about.feat4.title": "24/7 Availability",
    "about.feat4.desc": "Continuous support at every stage of the process, from start to finish",
    "contact.badge": "Free Consultation",
    "contact.heading": "Get a Personalized Investment Offer",
    "contact.subheading": "Leave your details and we'll get back to you within 24 hours for a short introductory call",
    "contact.name.label": "Full Name",
    "contact.name.placeholder": "Enter your name",
    "contact.phone.label": "Phone",
    "contact.phone.placeholder": "050-000-0000",
    "contact.email.label": "Email (optional)",
    "contact.email.placeholder": "your@email.com",
    "contact.submit": "Get Free Consultation",
    "contact.submitting": "Sending...",
    "contact.success.title": "Form submitted successfully!",
    "contact.success.desc": "We'll get back to you within 24 hours",
    "contact.success.heading": "Thank you for contacting us!",
    "contact.success.text": "We received your details and will get back to you within 24 hours.",
    "contact.success.another": "Send another inquiry",
    "contact.error.title": "Error submitting form",
    "contact.error.desc": "Please try again later",
    "footer.tagline": "Guiding investors through Dubai real estate investments in a simple, transparent, and organized manner.",
    "footer.license": "Licensed Local Agent - License 55545",
    "footer.quickLinks": "Quick Links",
    "footer.contactUs": "Contact Us",
    "footer.location": "Dubai, United Arab Emirates",
    "footer.followUs": "Follow Us",
    "footer.newsletter": "Get Updates:",
    "footer.emailPlaceholder": "Your email",
    "footer.subscribe": "Subscribe",
    "footer.subscribeSuccess": "Subscribed successfully!",
    "footer.subscribeSuccessDesc": "You'll receive updates directly to your email",
    "footer.emailError": "Please enter a valid email address",
    "footer.error": "An error occurred, please try again later",
    "footer.copyright": "All Rights Reserved.",
    "whyDubai.badge": "Investment Benefits",
    "whyDubai.heading": "Why Invest in Dubai?",
    "whyDubai.subheading": "Dubai has become a global investment hub. From a regional city – to a global center for business, capital, and population",
    "whyDubai.bottom.title": "The Bottom Line",
    "whyDubai.bottom.text": "This isn't a \"temporary bubble\", but rather",
    "whyDubai.bottom.highlight": "a long-term national strategy",
    "whyDubai.bottom.text2": ". The UAE government invests billions in infrastructure, tourism, and technology development to make Dubai a global center.",
    "process.badge": "Investment Process",
    "process.heading": "10 Steps to Successful Investment",
    "process.subheading": "A structured and transparent process that ensures peace of mind and confidence at every step toward investing in Dubai",
    "process.bottom": "An organized process is the key to a safe and successful investment",
    "stats.title": "Our Numbers Speak",
    "stats.subtitle": "Proven Performance in Dubai Real Estate",
    "stats.projects": "Active Projects",
    "stats.investors": "Happy Investors",
    "stats.yield": "Average Yield",
    "stats.experience": "Years Experience",
    "calc.badge": "Smart Investment Calculator",
    "calc.title": "How Much Will You Earn from Dubai Investment?",
    "calc.subtitle": "Enter your budget and get a personalized estimate of expected returns",
    "calc.budget": "Investment Budget",
    "calc.budgetNote": "(Input in AED, display in selected currency)",
    "calc.expectedRoi": "Expected Annual Return (%)",
    "calc.expectedRoiNote": "Enter your expected annual return percentage",
    "calc.perYear": "per year",
    "calc.type": "Investment Type",
    "calc.type.placeholder": "Choose investment type",
    "calc.type.offplan": "Off-Plan",
    "calc.type.offplan.desc": "Purchase from developer before construction completion - high appreciation potential",
    "calc.type.ready": "Ready Property",
    "calc.type.ready.desc": "Ready to rent property - steady cash flow",
    "calc.type.mixed": "Mixed",
    "calc.type.mixed.desc": "Combination of appreciation and ongoing returns",
    "calc.timeline": "Investment Period (Years)",
    "calc.timeline.one": "One year",
    "calc.timeline.years": "years",
    "calc.forecast": "Your Forecast",
    "calc.investment": "Investment Amount",
    "calc.period": "Period",
    "calc.expected": "Expected Value at End of Period",
    "calc.monthly": "Expected Monthly Rental Income",
    "calc.cta": "Get Personalized Recommendation",
    "calc.disclaimer": "* Forecast is based on market averages and does not guarantee returns",
    "calc.historical.title": "Historical Reference – Dubai Property Appreciation",
    "calc.historical.intro": "For comparison purposes only, market data indicates that over the last decade, residential property prices in Dubai have risen by approximately 80%+ cumulatively, with a multi-year average ranging around 7%–9% per year, with volatility between strong and weak years.",
    "calc.historical.point1": "Cumulative increase in the last decade (2012–2024): approx. 80%+",
    "calc.historical.point2": "Estimated multi-year average: approx. 7%–9% per year",
    "calc.historical.point3": "In particularly strong years: double-digit increases possible",
    "calc.historical.point4": "In weak years: stagnation or temporary declines possible",
    "calc.historical.disclaimer": "Historical data only, based on general market trends, and does not constitute a promise, forecast, or investment advice. The calculator result is based solely on the data you entered.",
    "projects.badge": "Selected Projects",
    "projects.heading": "Hot Projects in Dubai",
    "projects.subheading": "A selection of leading projects from the best developers in sought-after areas",
    "projects.filter": "Filter by Area",
    "projects.all": "All Areas",
    "projects.compare": "Compare",
    "projects.coming": "New projects coming soon...",
    "projects.featured": "Featured",
    "projects.startingFrom": "Starting from ",
    "projects.details": "More Details",
    "projects.compare.title": "Compare Projects",
    "projects.compare.param": "Parameter",
    "projects.compare.price": "Starting Price",
    "projects.compare.roi": "Expected ROI",
    "projects.compare.location": "Location",
    "projects.compare.developer": "Developer",
    "projects.compare.type": "Property Type",
    "projects.compare.delivery": "Delivery Date",
    "projects.compare.ready": "Ready",
    "map.badge": "Interactive Map",
    "map.title": "Hot Investment Areas in Dubai",
    "map.subtitle": "Click on an area on the map for detailed information on yields, demand and available projects",
    "map.unavailable": "Map Unavailable",
    "map.unavailable.desc": "Mapbox key required to display interactive map",
    "map.loading": "Loading map...",
    "map.reset": "Reset",
    "map.projects": "Projects",
    "map.avgRoi": "Average ROI",
    "map.rental": "Rental Yield",
    "map.appreciation": "Appreciation",
    "map.demand": "Demand Level",
    "map.demand.veryHigh": "Very High Demand",
    "map.demand.high": "High Demand",
    "map.demand.medium": "Medium Demand",
    "map.demand.premium": "Premium Market",
    "map.zoneProjects": "Projects in Area",
    "map.noProjects": "No projects in this area currently",
    "map.startingFrom": "Starting from ",
    "map.selectZone": "Select Area",
    "map.selectZone.desc": "Click on one of the areas on the map for detailed information",
    "map.tapToExplore": "Tap to explore map",
    "map.done": "Done",
    "whyddl.badge": "Why DDL",
    "whyddl.heading": "What Makes Us Different?",
    "whyddl.subheading": "Simplicity. Transparency. Personal Support.",
    "whyddl.quote1": "Our goal is not to sell a property,",
    "whyddl.quote2": "but to build the right deal for the right timeline",
    "whyddl.reason1.title": "Local Agent in Dubai",
    "whyddl.reason1.desc": "We live and operate from Dubai - not remote agents. Real access to projects and direct work with developers.",
    "whyddl.reason2.title": "Transparent & Organized Process",
    "whyddl.reason2.desc": "5 clear steps with no surprises. We present the full picture - benefits alongside risks.",
    "whyddl.reason3.title": "No Hidden Fees",
    "whyddl.reason3.desc": "Transparent fees upfront. What's agreed is what happens. No extras and no fine print.",
    "whyddl.reason4.title": "Personal Support",
    "whyddl.reason4.desc": "Every investor gets a personal account manager who guides them from the first step to beyond closing.",
    "whyddl.reason5.title": "Available 24/7",
    "whyddl.reason5.desc": "Always available for questions and updates. Time differences don't slow us down.",
    "whyddl.reason6.title": "Transaction Security",
    "whyddl.reason6.desc": "We work only with approved developers and provide full legal support at every step.",
    "cases.badge": "Case Studies",
    "cases.title": "Real Investors, Real Results",
    "cases.subtitle": "Examples of successful investments we guided - from initial investment to realization",
    "cases.initial": "Initial Investment",
    "cases.current": "Current Value",
    "cases.invested": "Invested in ",
    "cases.yielding": "Yielding Property",
    "cases.sold": "Sold in ",
    "cases.disclaimer": "* Data is based on real transactions. Investor names are hidden for privacy.",
    "developers.title": "Working with Leading Developers",
    "zones.badge": "Investment Zones",
    "zones.title": "Hot Investment Zones in Dubai",
    "zones.subtitle": "Select a zone for detailed information on yields, demand, and available projects",
    "zones.roi": "ROI",
    "zones.rental": "Rental",
    "zones.appreciation": "Appreciation",
    "zones.avgRoi": "Average ROI",
    "zones.rentalYield": "Rental Yield",
    "zones.demandLevel": "Demand Level",
    "zones.projectsCount": "Projects",
    "zones.viewDetails": "View Details",
    "zones.zoneProjects": "Zone Projects",
    "zones.noProjects": "No projects in this zone currently",
    "zones.getConsultation": "Get Consultation for This Zone",
  },
};

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

export function LanguageProvider({ children }: { children: ReactNode }) {
  const [language, setLanguage] = useState<Language>(() => {
    if (typeof window !== "undefined") {
      const saved = localStorage.getItem("ddl-language");
      return (saved as Language) || "he";
    }
    return "he";
  });
  const [cmsContent, setCmsContent] = useState<ContentBlock[]>(cmsContentCache || []);

  useEffect(() => {
    localStorage.setItem("ddl-language", language);
    document.documentElement.dir = language === "he" ? "rtl" : "ltr";
    document.documentElement.lang = language;
  }, [language]);

  // Load CMS content on mount
  useEffect(() => {
    fetchCmsContent().then(setCmsContent);
  }, []);

  const t = useCallback((key: string): string => {
    // First, try to get from CMS
    const cmsMapping = i18nKeyToCms(key);
    if (cmsMapping && cmsContent.length > 0) {
      const block = cmsContent.find(
        (b) => b.section === cmsMapping.section && b.blockKey === cmsMapping.blockKey && b.isActive
      );
      if (block) {
        const value = language === "en" ? (block.valueEn || block.value) : block.value;
        if (value) return value;
      }
    }

    // Fall back to hardcoded translations
    return translations[language][key] || key;
  }, [language, cmsContent]);

  const isRTL = language === "he";

  return (
    <LanguageContext.Provider value={{ language, setLanguage, t, isRTL }}>
      {children}
    </LanguageContext.Provider>
  );
}

export function useLanguage() {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error("useLanguage must be used within a LanguageProvider");
  }
  return context;
}
